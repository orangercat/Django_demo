{% extends 'basesite.html' %}

<!-- Header -->
{% block title %} Editor | Home {% endblock %}
<!-- Header End-->

<!-- Main Page-->
{% block breadcrumb %}
    <ol class="breadcrumb visible-sm visible-md visible-lg">
        <li><a href="/"><i class="icon fa fa-home"></i>Home</a></li>
        <li class="active"><i class="fa fa-file-text-o"></i>Editor</li>
    </ol>
{% endblock %}

{% block pull-right %}
    <h2>Editor</h2>
{% endblock %}

{% block main_content %}
    <form id="form" class="form-horizontal" method="post">
        {% csrf_token %}
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="panel panel-default bk-bg-white">
                    <div class="panel-heading bk-bg-white">
                        <h6><i class="fa fa-table red"></i><span class="break"></span>Editor</h6>
                        <div class="panel-actions">
                            <a href="#" class="btn-minimize"><i class="fa fa-caret-up"></i></a>
                        </div>
                    </div>
                    <div class="panel-body">
                        {% if request.session.current_role == 'Editor' %}
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="bk-margin-bottom-10">
                                        <a class="btn btn-info" href="/editor/add">
                                            Add <i class="fa fa-plus"></i>
                                        </a>
                                        <button class="btn btn-danger" type="submit" id="btnDelete" name="btnDelete" value="btnDelete">
                                            Delete <i class="fa fa-minus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        {% csrf_token %}
                        <table class="table table-bordered table-striped table-hover" id="datatable-default">
                            <thead>
                            <tr>
                                <th><input type="checkbox" name="checkAll" id="checkAll"/></th>
                                <th>Tilte</th>
                                <th>Summary</th>
                                <!-- <th>Content</th> -->
                                <th>Create Day</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for new in news %}
                                <tr>
                                    <td><input type="checkbox" name="checkbox" id="checkbox" value="{{ new.id }}"/></td>
                                    <td valign="">{{ new.title }}</td>
                                    <td>{{ new.summary }}</td>
                                    <!-- <td>{{new.content}}</td> -->
                                    <td>{{ new.create_date }}</td>
                                    <td>
                                        {% if new.editor_generated %}
                                            <span class="label label-info">POST</span>
                                        {% else %}
                                            <span class="label label-default">Drafted</span>
                                        {% endif %}
                                    </td>

                                    <td>
                                        <a class="btn btn-default" href="/editor/{{ new.id }}">
                                            <i class="fa fa-search-plus "></i>
                                        </a>
                                        {% if not new.editor_generated and request.session.current_role == 'Editor' %}
                                            <a class="btn btn-info" href="/editor/generate/{{ new.id }}">
                                                <i class="fa fa-edit "></i>
                                            </a>
                                        {% endif %}
                                    </td>

                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </form>
{% endblock %}

{% block notification %}
    <div id="msg_level" hidden="hidden">{{ msg_level }} </div>
    <div id="msg_content" hidden="hidden">{{ msg_content }} </div>
    <!--<script>-->
    <!--console.log('{{ msg_level }}')-->
    <!--</script>-->
{% endblock %}
<!-- Main Page-->

<!-- Page JS -->
{% block page_js %}
    <script src="../assets/js/pages/offer.js"></script>
    <script>
        $(function () {
            function initTableCheckbox() {
                var $thr = $('table thead tr');
                var $checkAllTh = $('<th><input type="checkbox" id="checkAll" name="checkAll" /></th>');
                /*将全选/反选复选框添加到表头最前，即增加一列*/
                //$thr.prepend($checkAllTh);
                /*“全选/反选”复选框*/
                var $checkAll = $thr.find('input');
                $checkAll.click(function (event) {
                    /*将所有行的选中状态设成全选框的选中状态*/
                    $tbr.find('input').prop('checked', $(this).prop('checked'));
                    /*并调整所有选中行的CSS样式*/
                    if ($(this).prop('checked')) {
                        $tbr.find('input').parent().parent().addClass('warning');
                    } else {
                        $tbr.find('input').parent().parent().removeClass('warning');
                    }
                    /*阻止向上冒泡，以防再次触发点击操作*/
                    event.stopPropagation();
                });
                /*点击全选框所在单元格时也触发全选框的点击操作*/
                $checkAllTh.click(function () {
                    $(this).find('input').click();
                });
                var $tbr = $('table tbody tr');
                var $checkItemTd = $('<td><input type="checkbox" name="checkbox"/></td>');
                /*每一行都在最前面插入一个选中复选框的单元格*/
                //$tbr.prepend($checkItemTd);
                /*点击每一行的选中复选框时*/
                $tbr.find('input').click(function (event) {
                    /*调整选中行的CSS样式*/
                    $(this).parent().parent().toggleClass('warning');
                    /*如果已经被选中行的行数等于表格的数据行数，将全选框设为选中状态，否则设为未选中状态*/
                    $checkAll.prop('checked', $tbr.find('input:checked').length == $tbr.length ? true : false);
                    /*阻止向上冒泡，以防再次触发点击操作*/
                    event.stopPropagation();
                });
                /*点击每一行时也触发该行的选中操作*/
                $tbr.click(function () {
                    $(this).find('input').click();
                });
            }

            initTableCheckbox();
        });
    </script>
{#    <script>#}
{#        $(document).ready(function () {#}
{#            $.ajaxSetup({#}
{#                data: {csrfmiddlewaretoken: '{{ csrf_token }}'},#}
{#            });#}
{#            $('#form').submit(function () {#}
{#                var checkbox = $("input[name='checkbox']:checked").serialize();#}
{#                //var password = $("#id_password").val();    //同上#}
{##}
{#                $.ajax({#}
{#                    type: "POST",#}
{#                    data: checkbox,#}
{#                    url: "/editor", //后台处理函数的url 这里用的是static url 需要与urls.py中的name一致#}
{#                    cache: false,#}
{#                    dataType: "html",#}
{#                    success: function (result, statues, xml) {#}
{#                        alert(result);                                         //成功时弹出view传回来的结果#}
{#                    },#}
{#                    error: function () {#}
{#                        alert("false");#}
{#                    }#}
{#                });#}
{#                return false;#}
{#            });#}
{##}
{#        });#}
{#    </script>#}

{% endblock %}
<!-- Page JS -->
